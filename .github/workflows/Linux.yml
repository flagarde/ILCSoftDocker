name: Linux

on:
    push:
    pull_request:
    schedule:
    #Every Sunday at midnight
    - cron:  '0 0 * * 0'

env:
  NBR_CORE: 2
  ILC_INSTALL_VERSION: v02-01-02
  INSTALL_MODE: LATEST
  # Dockerfile.ubuntu18.04-gcc9.1 Docker.alpine
  OS: ubuntu18.04-gcc9.1

jobs:

  build:
    name: "Build"
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false
    steps:
    - name: Checkout
      uses: actions/checkout@v2.3.4
    - name: Change geant4 location
      run: sed -i 's#self.download.url = "http://geant4.cern.ch/support/source/geant4.%s.tar.gz" % self.version#self.download.url = "http://cern.ch/geant4-data/releases/patch_geant4.%s.tar.gz" % self.version#g' ./ilcsoft/geant4.py      
    - name: Build docker image OS
      run: docker build --tag os --file Dockerfile.${{ env.OS }} .
    - name: Build docker base
      run: docker build --file Dockerfile.base --tag ilcsoft/base-ubuntu18.04-gcc9.1 --build-arg image=os --build-arg compile_ncores=${{ env.NBR_CORE }} --build-arg ilcinstall_version=${{ env.ILC_INSTALL_VERSION }} --build-arg install_mode=${{ env.INSTALL_MODE }} .
